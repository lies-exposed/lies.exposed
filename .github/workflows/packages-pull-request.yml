name: Packages - Pull Request


# with wait-on-check-action
# https://github.com/marketplace/actions/wait-on-check
#
# on:
#   workflow_call:
# jobs:
#   callee:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Wait for Other Workflows
#         uses: lewagon/wait-on-check-action@v1.3.4
#         with:
#           ref: ${{ github.ref }}
#           running-workflow-name: 'caller / callee'
#           repo-token: ${{ secrets.GITHUB_TOKEN }}
#           wait-interval: 10
on:
  workflow_call:
    # inputs:
    #   hash: { required: true, type: string }

jobs:
  install:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: ./.github/actions/install-deps
        with:
          hash: ${{ hashFiles('**/yarn.lock') }}

      - name: Install modules
        run: yarn
  build:
    runs-on: ubuntu-latest
    needs: [install]
    steps:
      - uses: ./.github/actions/build-packages
        with:
          hash: ${{ github.sha }}
  lint:
    needs: [build]
    runs-on: ubuntu-latest
    steps:
      - name: Lint code
        run: |
          yarn core lint
          yarn shared lint
          yarn test lint
          yarn ui lint

  test:
    needs: [build]
    runs-on: ubuntu-latest
    steps:
      - name: Test code
        run: |
          yarn shared test
