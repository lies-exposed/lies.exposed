version: "3"

services:

  api:
    image: ghcr.io/lies-exposed/liexp-api:alpha-latest
    container_name: liexp-api
    user: $API_UID:$API_GID
    env_file:
      # - ../.env.alpha
      - .env.api
    environment:
      - DEBUG=@liexp*
    ports:
      - "4010:4010"
    volumes:
      # - ../services/api/certs/:/app/services/api/certs/:ro
      - ./certs/:/app/services/api/certs/:ro
      - ./temp/:/app/services/api/temp/:rw
      - ./config/:/app/services/api/config/:rw
    working_dir: /app/services/api
    command: yarn start
    restart: always

  web:
    image: ghcr.io/lies-exposed/liexp-web:alpha-latest
    container_name: liexp-web
    env_file:
      # - ../services/web/.env
      - .env.web
    environment:
      API_URL: http://api:4010/v1
      ADMIN_URL: https://alpha.lies.exposed/admin
    ports:
      - "4020:4020"
    links:
      - api
    working_dir: /app/services/web
    command: yarn serve
    restart: always