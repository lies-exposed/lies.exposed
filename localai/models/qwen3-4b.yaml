backend: llama-cpp
context_size: 16384
gpu_layers: 36
f16: true
# mmap must be disabled for SYCL (Intel GPU) - causes hangs
mmap: false
name: qwen3-4b
reasoning:
  disable: true
parameters:
  model: Qwen3-4B.Q4_K_M.gguf
stopwords:
  - <|im_end|>
  - <dummy32000>
  - </s>
  - <|endoftext|>
  - </tool_call>

function:
  disable_no_action: false
  grammar:
    disable: true
  return_name_in_function_response: true
  json_regex_match:
    - "(?s)<tool_call>\\s*\\[?\\s*(\\{.*?\\})\\s*\\]?\\s*</tool_call>"
    - "(?s)<tool_call>\\s*\\[?\\s*(\\{.*?)\\s*\\]?\\s*$"
  replace_llm_results:
    - key: "(?s)<think>.*?</think>"
      value: ""
    - key: "(?s)<scratchpad>.*?</scratchpad>"
      value: ""
    - key: "^\\n+"
      value: ""

template:
  chat: |
    {{.Input -}}
    <|im_start|>assistant
    <think>
    </think>
  chat_message: |
    <|im_start|>{{if eq .RoleName "tool" }}user{{else}}{{ .RoleName }}{{end}}
    {{ if eq .RoleName "tool" -}}
    <tool_response>
    {{ end -}}
    {{ if .Content -}}
    {{.Content }}
    {{ end -}}
    {{ if eq .RoleName "tool" -}}
    </tool_response>
    {{ end -}}
    {{ if .FunctionCall -}}
    <tool_call>
    {{toJson .FunctionCall}}
    </tool_call>
    {{ end -}}<|im_end|>
  completion: |
    {{.Input}}
  function: |
    <|im_start|>system
    You are a helpful assistant with access to tools. You can call tools and then provide a final response based on the results.

    Available tools:
    <tools>
    {{range .Functions}}
    {'type': 'function', 'function': {'name': '{{.Name}}', 'description': '{{.Description}}', 'parameters': {{toJson .Parameters}} }}
    {{end}}
    </tools>

    Instructions:
    1. If you need information from tools, call them using this format:
       <tool_call>
       {"arguments": <args-dict>, "name": <function-name>}
       </tool_call>
    2. After receiving tool results, provide a helpful response based on the information.
    3. If no tools are needed, respond directly with plain text. Do NOT wrap your response in a tool_call. Do NOT invent tool names like "answer" â€” just write your response.
    4. Always end with a complete response to help the user.<|im_end|>
    {{.Input -}}
    <|im_start|>assistant
    <think>
    </think>
